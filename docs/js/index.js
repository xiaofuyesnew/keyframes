"use strict";var app=new Vue({el:"#app",data:{sizeType:"1",canvasData:{width:640,height:480},frameData:{row:1,col:1,prewidth:640,preheight:480},fileList:[],imgLoading:!1,cssStr:"",cssAttr:{unit:"px"},imgStr:"",btnText:"开始生成",btnLoading:!1},computed:{canvas:function(){return"1"===this.sizeType?{width:+this.canvasData.width,height:+this.canvasData.height}:"2"===this.sizeType?{width:this.frameData.col*this.frameData.prewidth,height:this.frameData.row*this.frameData.preheight}:void 0}},methods:{fileChange:function(t,a){this.fileList=a},fileRemove:function(t,a){this.fileList=a},dealCss:function(t,a){for(var e=(100/this.fileList.length).toFixed(2),i="",s=0;s<this.fileList.length;s++)0===s?i+="  0% { background-position: 0 0; }":s===this.fileList.length-1?i+="\n  100% { background-position: 0 0; }":i+="\n  ".concat((e*s).toFixed(2),"% { background-position: 0 0; }");console.log(i)},startDealing:function(t){var e=document.getElementById("cvs");0===t&&(e.height=e.height);var i=e.getContext("2d"),s=this,n=t,h=new Image,a=new FileReader;this.btnText="生成中",this.btnLoading=!0,h.onload=function(){var t=1,a=1;switch(s.sizeType){case"1":a=+s.canvasData.width/+s.frameData.prewidth,t=+s.canvasData.height/+s.frameData.preheight;break;case"2":a=+s.frameData.col,t=+s.frameData.row}0===n&&s.dealCss(t,a),i.drawImage(h,n%a*+s.frameData.prewidth,Math.floor(n/a)*+s.frameData.preheight),n++,s.fileList.length>n?setTimeout(function(){s.startDealing(n)},1e3):(s.imgStr=e.toDataURL("image/png"),s.btnText="开始生成",s.btnLoading=!1,s.$message.success("图片生成完成"))},a.onload=function(t){h.src=t.target.result},a.readAsDataURL(this.fileList[n].raw)}}});